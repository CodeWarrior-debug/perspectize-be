---
phase: 02.1-mobile-responsive-fixes
plan: 02
type: execute
wave: 2
depends_on: ["02.1-01"]
files_modified:
  - frontend/src/lib/components/ActivityTable.svelte
  - frontend/tests/components/ActivityTable.test.ts
autonomous: false

must_haves:
  truths:
    - "Table content aligns within viewport bounds at 375px (no left-shift overflow)"
    - "At 375px, only the Title column is visible (non-essential columns hidden)"
    - "At 768px+, all columns are visible"
    - "Visual verification at 375px confirms header, pagination, and table all fit"
  artifacts:
    - path: "frontend/src/lib/components/ActivityTable.svelte"
      provides: "Responsive column hiding via gridSizeChanged event"
      contains: "updateColumnVisibility"
    - path: "frontend/tests/components/ActivityTable.test.ts"
      provides: "Tests for column visibility logic"
      min_lines: 50
  key_links:
    - from: "frontend/src/lib/components/ActivityTable.svelte"
      to: "AG Grid API"
      via: "gridSizeChanged event and setColumnsVisible"
      pattern: "onGridSizeChanged"
    - from: "frontend/src/lib/components/ActivityTable.svelte"
      to: "AG Grid API"
      via: "gridApi.setColumnsVisible"
      pattern: "setColumnsVisible"
---

<objective>
Fix table content left-shift overflow (BUG-005) by adding responsive column hiding, then visually verify all Phase 2.1 fixes at 375px.

Purpose: At 375px, the AG Grid table has too many columns for the viewport width, causing horizontal overflow and a left-shifted appearance. Programmatically hiding non-essential columns at narrow widths keeps the table within bounds. The visual checkpoint confirms all three P1/P2 fixes work together.

Output: ActivityTable with responsive column visibility management, updated tests, and visual verification at 375px confirming all Phase 2.1 fixes.
</objective>

<execution_context>
@/Users/jamesjordan/.claude/get-shit-done/workflows/execute-plan.md
@/Users/jamesjordan/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02.1-mobile-responsive-fixes/02.1-RESEARCH.md
@.planning/phases/02.1-mobile-responsive-fixes/02.1-01-SUMMARY.md
@frontend/src/lib/components/ActivityTable.svelte
@frontend/tests/components/ActivityTable.test.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add responsive column hiding to ActivityTable</name>
  <files>
    frontend/src/lib/components/ActivityTable.svelte
    frontend/tests/components/ActivityTable.test.ts
  </files>
  <action>
**ActivityTable.svelte changes (BUG-005):**

Add an `updateColumnVisibility` function that uses the grid API to hide/show columns based on container width. Add `field` property to the Duration column definition so setColumnsVisible can target it by key.

1. Add a `field` property to the Duration column definition (currently it has only `headerName` and `valueGetter`). Add `colId: 'duration'` (since it uses valueGetter, not field, use colId for identification):
   ```typescript
   {
     colId: 'duration',
     headerName: 'Duration',
     width: 120,
     ...
   }
   ```

2. Add the `updateColumnVisibility` function after the gridOptions declaration:

```typescript
function updateColumnVisibility() {
  if (!gridApi) return;

  const container = document.querySelector('.ag-root-wrapper');
  if (!container) return;

  const gridWidth = (container as HTMLElement).offsetWidth;

  // Progressive column hiding based on width
  // < 640px (mobile): Title only
  // 640-767px (small tablet): Title + Type + Duration
  // 768px+ (tablet/desktop): All columns
  if (gridWidth < 640) {
    gridApi.setColumnsVisible(['contentType', 'duration', 'createdAt', 'updatedAt'], false);
  } else if (gridWidth < 768) {
    gridApi.setColumnsVisible(['contentType', 'duration'], true);
    gridApi.setColumnsVisible(['createdAt', 'updatedAt'], false);
  } else {
    gridApi.setColumnsVisible(['contentType', 'duration', 'createdAt', 'updatedAt'], true);
  }
}
```

Note: Use `colId: 'duration'` in column def and `'duration'` in setColumnsVisible. For columns with `field` property (contentType, createdAt, updatedAt), the field name is used as the column key by AG Grid.

3. Add `onGridSizeChanged` to gridOptions:

```typescript
onGridSizeChanged: () => {
  updateColumnVisibility();
}
```

4. Update `onGridReady` to call `updateColumnVisibility()` after setting gridApi:

```typescript
onGridReady: (params) => {
  gridApi = params.api;
  updateColumnVisibility();
}
```

**ActivityTable.test.ts changes:**

Add tests for the column visibility logic. Since AG Grid is mocked, test the `updateColumnVisibility` function indirectly by verifying:

1. Add a test: `'renders wrapper div with w-full class'` — verify the outer div has w-full class (ensures no fixed width overflow)

2. Add a test: `'grid options include onGridSizeChanged handler'` — render component, verify the mock was called with gridOptions that include onGridSizeChanged. This requires updating the mock to capture the props passed to it.

Update the AG Grid mock to capture passed props:

```typescript
let capturedGridOptions: any = null;

vi.mock('ag-grid-svelte5', () => ({
  default: vi.fn((props: any) => {
    capturedGridOptions = props?.gridOptions || props?.$$props?.gridOptions;
    return {
      $$: {},
      $set: vi.fn(),
      $on: vi.fn(),
      $destroy: vi.fn(),
    };
  }),
}));
```

Then test that capturedGridOptions has `onGridSizeChanged` as a function.

3. Add a test: `'grid options include onGridReady handler'` — verify onGridReady is defined.

4. Add a test: `'column definitions include colId for duration column'` — verify the duration column has a colId for responsive hiding identification.
  </action>
  <verify>
Run `cd fe && pnpm run test:run` — all ActivityTable tests pass (existing 4 + new 4 = 8 tests).
Run `cd fe && pnpm run check` — no TypeScript errors.
Run `grep -q "updateColumnVisibility" frontend/src/lib/components/ActivityTable.svelte && echo "PASS"` — column visibility function present.
Run `grep -q "onGridSizeChanged" frontend/src/lib/components/ActivityTable.svelte && echo "PASS"` — grid size handler present.
  </verify>
  <done>
ActivityTable.svelte has updateColumnVisibility function called on gridReady and gridSizeChanged, progressively hiding columns at mobile widths. Duration column has colId for identification. All ActivityTable tests pass.
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
All Phase 2.1 mobile responsive fixes:
- BUG-001: Header overflow fixed with min-w-0 + truncate on logo, shrink-0 on interactive elements, responsive gap/text sizing
- BUG-002: AG Grid pagination bar wraps with CSS override (height: auto, flex-wrap: wrap-reverse)
- BUG-003: Sticky header clipping fixed (same root cause as BUG-001)
- BUG-005: Table columns hide progressively at narrow widths (only Title at 375px)
  </what-built>
  <how-to-verify>
1. Start the frontend dev server: `cd fe && pnpm run dev`
2. Start the backend: `cd backend && make run`
3. Use Chrome DevTools MCP to verify at 375px:
   - `mcp__chrome-devtools__resize_page` to 375x812 (iPhone SE)
   - `mcp__chrome-devtools__navigate_page` to http://localhost:5173
   - `mcp__chrome-devtools__take_screenshot` with filePath ~/Downloads/screenshots/ccsv-02.1-02-mobile-375px.png and fullPage: true

4. Verify visually:
   - Header: Logo text, UserSelector dropdown, and Add Video button all visible without horizontal overflow
   - Logo may truncate with ellipsis at 375px - this is correct behavior
   - Pagination bar: Controls wrap cleanly, readable text, usable tap targets
   - Table: Only Title column visible at 375px, no horizontal scrollbar, content within viewport bounds

5. Resize to 768px and verify:
   - `mcp__chrome-devtools__resize_page` to 768x1024
   - `mcp__chrome-devtools__take_screenshot` with filePath ~/Downloads/screenshots/ccsv-02.1-02-tablet-768px.png
   - All table columns visible
   - Header has normal spacing
   - Pagination bar on single line

6. Resize to 1280px and verify:
   - `mcp__chrome-devtools__resize_page` to 1280x800
   - `mcp__chrome-devtools__take_screenshot` with filePath ~/Downloads/screenshots/ccsv-02.1-02-desktop-1280px.png
   - Full desktop layout, all elements comfortable

7. Check for console errors:
   - `mcp__chrome-devtools__list_console_messages` — no JavaScript errors
  </how-to-verify>
  <resume-signal>Type "approved" if all checks pass, or describe any issues</resume-signal>
</task>

</tasks>

<verification>
1. `cd fe && pnpm run check` — no TypeScript errors
2. `cd fe && pnpm run test:run` — all tests pass (Header: 13, ActivityTable: 8)
3. Visual verification at 375px — header fits, pagination wraps, table columns hidden appropriately
4. Visual verification at 768px — all columns visible, normal layout
5. No console errors at any viewport size
</verification>

<success_criteria>
- ActivityTable hides non-essential columns at mobile widths via gridSizeChanged + setColumnsVisible
- At 375px: only Title column visible, no horizontal overflow
- At 768px+: all columns visible
- Visual checkpoint confirms all Phase 2.1 fixes work together
- All tests pass, no TypeScript errors
</success_criteria>

<output>
After completion, create `.planning/phases/02.1-mobile-responsive-fixes/02.1-02-SUMMARY.md`
</output>
