# Phase 2.1: Mobile Responsive Fixes - Research

**Researched:** 2026-02-07
**Domain:** Mobile responsive design (375px viewport), CSS flexbox layout, AG Grid pagination customization
**Confidence:** HIGH

## Summary

This phase addresses critical P1/P2 mobile responsive issues at 375px (iPhone SE) affecting header overflow, AG Grid pagination bar readability, and table content alignment. Research reveals three primary problem areas:

1. **Header overflow** is caused by flexbox default `min-width: auto` behavior preventing child elements from shrinking below content size, combined with insufficient space for all header elements (logo + UserSelector + Button) at 375px width
2. **AG Grid pagination bar issues** are a known problem in AG Grid (GitHub issue #9239) with documented CSS workarounds using flex-wrap and height: auto
3. **Table content left-shift** relates to AG Grid's default horizontal scroll behavior and lack of responsive column hiding

Standard solutions exist for all three issues without requiring custom implementations. The approach combines CSS flexbox min-width fixes, AG Grid CSS pagination panel overrides, and programmatic column visibility management via gridSizeChanged events.

**Primary recommendation:** Apply CSS flexbox min-width: 0 to header elements, implement AG Grid community-proven pagination CSS workarounds, and add gridSizeChanged listener to hide non-essential columns at mobile widths.

## Standard Stack

### Core

| Library | Version | Purpose | Why Standard |
|---------|---------|---------|--------------|
| Tailwind CSS | v4.x | Responsive utility classes | Project standard, provides mobile-first breakpoints (sm: 640px, md: 768px) |
| AG Grid | v32.2.x | Table pagination styling | Already in use via ag-grid-svelte5 wrapper |
| CSS Flexbox | Native | Header layout management | Browser native, no library needed |

### Supporting

| Library | Version | Purpose | When to Use |
|---------|---------|---------|-------------|
| @ag-grid-community/theming | 32.2.0 | Theme parameter customization | For global compactness/spacing adjustments |
| shadcn-svelte | Current | Pre-built responsive components | For Sheet/Drawer if adding mobile menu |

### Alternatives Considered

| Instead of | Could Use | Tradeoff |
|------------|-----------|----------|
| CSS pagination fix | Custom pagination controls | Custom controls = more complexity, AG Grid already provides suppressPaginationPanel option but requires full reimplementation |
| Programmatic column hiding | CSS media queries to hide columns | CSS can't calculate actual grid width, only viewport width; misses container query needs |
| Flexbox min-width fix | Fixed pixel widths | Fixed widths = brittle across devices, defeats responsive design |

## Architecture Patterns

### Recommended Component Structure

```
src/lib/components/
├── Header.svelte               # Add min-w-0 and responsive utilities
├── ActivityTable.svelte        # Add pagination CSS and column hiding logic
└── UserSelector.svelte         # Already exists, may need min-w-0
```

### Pattern 1: Flexbox Text Truncation with min-width: 0

**What:** Override flexbox default `min-width: auto` to allow child elements to shrink below content size
**When to use:** Any flex container where child text/buttons need to shrink or truncate at narrow widths
**Example:**

```svelte
<!-- Header.svelte - BEFORE (broken at 375px) -->
<div class="flex items-center gap-4">
  <a href="/" class="font-bold text-xl">Perspectize</a>
  <div class="flex items-center gap-4">
    <UserSelector />
    <Button>Add Video</Button>
  </div>
</div>

<!-- Header.svelte - AFTER (works at 375px) -->
<div class="flex items-center gap-2 md:gap-4">
  <!-- min-w-0 allows flex child to shrink -->
  <a href="/" class="font-bold text-lg md:text-xl min-w-0 truncate">Perspectize</a>
  <div class="flex items-center gap-2 md:gap-4 shrink-0">
    <UserSelector />
    <Button size="sm" class="text-sm">Add Video</Button>
  </div>
</div>
```

**Source:** [CSS-Tricks: Flexbox and Truncated Text](https://css-tricks.com/flexbox-truncated-text/), [Medium: Truncate Text in Flex Containers](https://medium.com/@ademyalcin27/truncate-text-in-flex-containers-d3b81cc02cef)

**Key insight:** Flexbox sets `min-width: auto` by default, which calculates minimum size based on content, preventing shrinkage. Setting `min-w-0` (Tailwind) or `min-width: 0` (CSS) overrides this and allows truncation.

### Pattern 2: AG Grid Pagination Panel CSS Override

**What:** Use CSS flex-wrap and height: auto to make pagination bar wrap on mobile instead of overflow
**When to use:** When AG Grid pagination controls break at narrow widths (known issue #9239)
**Example:**

```css
/* app.css - AG Grid pagination mobile fix */
.ag-paging-panel {
  height: auto;
  flex-wrap: wrap-reverse;
  row-gap: 1rem;
  padding: 0.25rem;
  align-items: center;
  justify-content: flex-end;
}

@media (max-width: 768px) {
  .ag-paging-panel {
    justify-content: center;
  }
}
```

**Source:** [AG Grid GitHub Issue #9239](https://github.com/ag-grid/ag-grid/issues/9239) - Community workaround by leonardo-panseri and Nirmal314

**Why this works:** Default pagination panel uses fixed height with no wrapping, causing text to overflow vertically on mobile. `flex-wrap: wrap-reverse` allows controls to stack, `height: auto` expands to fit wrapped content.

### Pattern 3: Responsive Column Hiding via gridSizeChanged

**What:** Dynamically show/hide columns based on grid width using AG Grid's gridSizeChanged event
**When to use:** When horizontal scrolling is undesirable and you want columns to automatically hide at narrow widths
**Example:**

```svelte
<script lang="ts">
  import type { GridApi, GridOptions } from '@ag-grid-community/core';

  let gridApi = $state<GridApi | null>(null);

  const gridOptions: GridOptions = {
    columnDefs: [
      { field: 'name', headerName: 'Title', flex: 2 },
      { field: 'contentType', headerName: 'Type', width: 100, hide: false },
      { field: 'duration', headerName: 'Duration', width: 120, hide: false },
      { field: 'createdAt', headerName: 'Date Added', width: 140, hide: false },
      { field: 'updatedAt', headerName: 'Last Updated', width: 140, hide: false }
    ],
    onGridReady: (params) => {
      gridApi = params.api;
      updateColumnVisibility(); // Initial check
    },
    onGridSizeChanged: () => {
      updateColumnVisibility();
    }
  };

  function updateColumnVisibility() {
    if (!gridApi) return;

    const gridWidth = gridApi.getContainer()?.offsetWidth ?? 0;

    // At 375px, only show Title column
    // At 768px+, show all columns
    const columnsToHide = gridWidth < 768
      ? ['contentType', 'duration', 'createdAt', 'updatedAt']
      : [];

    gridApi.setColumnsVisible(['contentType', 'duration', 'createdAt', 'updatedAt'], gridWidth >= 768);
  }
</script>
```

**Source:** [AG Grid: Responsive Design Patterns (Archive v17)](https://www.ag-grid.com/archive/17.0.0/javascript-grid-responsiveness/), [Hatchjs: Dynamic Show/Hide Columns](https://hatchjs.com/ag-grid-show-hide-columns-dynamic-stackblitz/)

**AG Grid v32 Note:** Column API was deprecated in v31 and merged into Grid API. Use `gridApi.setColumnsVisible(keys, visible)` instead of `columnApi.setVisible()`.

### Pattern 4: Responsive Header Text Sizing

**What:** Use Tailwind responsive text utilities to reduce font size at mobile widths
**When to use:** When header text is too large for narrow viewports
**Example:**

```svelte
<!-- Responsive text sizing with Tailwind -->
<a href="/" class="font-bold text-base sm:text-lg md:text-xl">
  Perspectize
</a>

<!-- Button size responsive -->
<Button size="sm" class="text-sm sm:text-base">
  Add Video
</Button>
```

**Source:** [Tailwind CSS: Responsive Design](https://tailwindcss.com/docs/responsive-design)

**Tailwind v4 breakpoints:**
- Default (mobile): 0-639px
- `sm:`: 640px+
- `md:`: 768px+
- `lg:`: 1024px+

### Anti-Patterns to Avoid

- **Using fixed pixel widths for header elements** — Breaks across different device widths, defeats responsive design
- **Hiding pagination panel with suppressPaginationPanel** — Requires building custom pagination from scratch, adds unnecessary complexity
- **Using CSS media queries to hide AG Grid columns** — Cannot detect actual grid container width, only viewport width; fails in split-screen scenarios
- **Setting explicit height on AG Grid wrapper with domLayout: 'autoHeight'** — Conflicts with autoHeight behavior, causes layout issues

## Don't Hand-Roll

Problems that look simple but have existing solutions:

| Problem | Don't Build | Use Instead | Why |
|---------|-------------|-------------|-----|
| Mobile hamburger menu | Custom drawer component | shadcn-svelte Sheet or existing libraries (svelte-hamburger, svelte-fluid-header) | Accessible, keyboard navigation, focus trapping, animation timing already solved |
| AG Grid pagination customization | Custom pagination controls | CSS overrides on `.ag-paging-panel` | Community has proven solutions, AG Grid's internal pagination logic complex |
| Responsive column visibility | Manual column width calculations | AG Grid's gridSizeChanged event + setColumnsVisible | Grid API provides container width, handles edge cases (column resizing, flex columns) |
| Text truncation in flexbox | JavaScript string truncation | CSS `truncate` class (Tailwind) or `text-overflow: ellipsis` | Browser-native, handles font variations, respects accessibility zoom |

**Key insight:** AG Grid is a complex enterprise library with extensive internal state management. Suppressing built-in features to build custom alternatives typically introduces bugs and maintenance burden. Prefer CSS overrides and API-driven configuration changes.

## Common Pitfalls

### Pitfall 1: Flexbox Default min-width Preventing Shrinkage

**What goes wrong:** Header logo text doesn't truncate at narrow widths, causes horizontal overflow
**Why it happens:** Flexbox sets `min-width: auto` by default, which prevents child from shrinking below content width
**How to avoid:** Add `min-w-0` (Tailwind) or `min-width: 0` to flex children that need to shrink
**Warning signs:**
- Horizontal scrollbar appears at mobile widths
- Flex parent has `overflow-x: auto` but children still overflow
- Text doesn't respect `truncate` class in flex container

**Source:** [BigBinary: Understanding Automatic Minimum Size of Flex Items](https://www.bigbinary.com/blog/understanding-the-automatic-minimum-size-of-flex-items)

### Pitfall 2: AG Grid Column API Deprecated in v31+

**What goes wrong:** Code uses `columnApi.setVisible()` or other Column API methods, but v32 throws errors
**Why it happens:** Column API was merged into Grid API in AG Grid v31, old methods removed in v32
**How to avoid:** Use `gridApi.setColumnsVisible(keys, visible)` instead of Column API methods
**Warning signs:**
- Build warnings about deprecated imports
- Runtime errors: "columnApi is undefined"
- Migration guide references v30/v31 breaking changes

**Source:** [AG Grid v32 Changelog](https://github.com/ag-grid/ag-grid/blob/v32.0.0/documentation/ag-grid-docs/public/changelog/releases/30_0_0.md)

### Pitfall 3: Using domLayout: 'autoHeight' with Large Datasets

**What goes wrong:** AG Grid renders slowly or freezes browser at mobile widths
**Why it happens:** autoHeight disables row virtualization, renders ALL rows into DOM (not just visible rows)
**How to avoid:** Only use autoHeight for small datasets (<100 rows). For larger datasets, use `domLayout: 'normal'` with fixed height
**Warning signs:**
- Noticeable render delay when loading table
- Browser DevTools shows thousands of DOM nodes
- Mobile devices lag when scrolling

**Source:** [AG Grid: Grid Layout](https://www.ag-grid.com/javascript-data-grid/grid-size/)

**Note:** Current implementation uses `domLayout: 'autoHeight'`. This is acceptable for Phase 2 dataset size, but should be monitored if content grows beyond 100 rows.

### Pitfall 4: Forgetting shrink-0 on Non-Shrinkable Elements

**What goes wrong:** UserSelector or Button elements shrink incorrectly, text becomes unreadable
**Why it happens:** Flex children have `flex-shrink: 1` by default, allowing all elements to shrink proportionally
**How to avoid:** Add `shrink-0` (Tailwind) to elements that must maintain minimum size (buttons, selects)
**Warning signs:**
- Buttons become too narrow to tap
- Select dropdowns overlap with text
- Interactive elements crushed at narrow widths

### Pitfall 5: Not Testing Actual Device vs Browser DevTools

**What goes wrong:** Layout looks correct in Chrome DevTools mobile emulation but breaks on real iPhone SE
**Why it happens:** DevTools doesn't always perfectly replicate:
- Touch target sizes (44px minimum on iOS)
- Browser chrome (URL bar) reducing viewport height
- System font rendering differences
- Actual viewport width including scrollbars

**How to avoid:** Test on real devices or use Chrome DevTools MCP with actual device presets
**Warning signs:**
- User reports issues that don't reproduce in DevTools
- Touch targets feel too small on device
- Horizontal scrolling on device but not DevTools

## Code Examples

Verified patterns from official sources:

### Tailwind Responsive Header (Mobile-First)

```svelte
<script lang="ts">
  import { Button } from '$lib/components/shadcn';
  import UserSelector from '$lib/components/UserSelector.svelte';

  function handleAddVideo() {
    toast.info('Add Video modal coming in Phase 3');
  }
</script>

<header class="h-16 border-b border-border bg-white sticky top-0 z-50">
  <div class="h-full px-4 md:px-6 lg:px-8 max-w-screen-xl mx-auto flex items-center justify-between gap-2 md:gap-4">
    <!-- min-w-0 allows shrinking, truncate handles overflow -->
    <a
      href="/"
      class="font-bold text-base sm:text-lg md:text-xl text-foreground hover:text-primary transition-colors min-w-0 truncate"
    >
      Perspectize
    </a>

    <!-- shrink-0 prevents interactive elements from shrinking -->
    <div class="flex items-center gap-2 md:gap-4 shrink-0">
      <UserSelector />
      <Button onclick={handleAddVideo} size="sm" class="text-sm md:text-base">
        Add Video
      </Button>
    </div>
  </div>
</header>
```

**Source:** Tailwind CSS responsive design patterns + flexbox min-width research

### AG Grid Pagination Mobile CSS

```css
/* src/app.css - Add to global styles */

/* AG Grid pagination mobile responsive fix */
.ag-paging-panel {
  height: auto !important;
  flex-wrap: wrap-reverse;
  row-gap: 1rem;
  padding: 0.25rem;
  align-items: center;
  justify-content: flex-end;
}

/* Center pagination controls on mobile */
@media (max-width: 768px) {
  .ag-paging-panel {
    justify-content: center;
  }
}

/* Optional: Reduce font size on very narrow widths */
@media (max-width: 375px) {
  .ag-paging-panel {
    font-size: 0.875rem; /* 14px */
  }
}
```

**Source:** [AG Grid GitHub Issue #9239](https://github.com/ag-grid/ag-grid/issues/9239) - Community workaround

### AG Grid Responsive Column Hiding

```svelte
<script lang="ts">
  import type { GridApi, GridOptions } from '@ag-grid-community/core';

  let gridApi = $state<GridApi | null>(null);

  const gridOptions: GridOptions<ContentRow> = {
    columnDefs: [
      { field: 'name', headerName: 'Title', flex: 2, sortable: true, filter: true },
      { field: 'contentType', headerName: 'Type', width: 100, sortable: true },
      { field: 'duration', headerName: 'Duration', width: 120, sortable: false },
      { field: 'createdAt', headerName: 'Date Added', width: 140, sortable: true },
      { field: 'updatedAt', headerName: 'Last Updated', width: 140, sortable: true }
    ],
    onGridReady: (params) => {
      gridApi = params.api;
      updateColumnVisibility();
    },
    onGridSizeChanged: () => {
      updateColumnVisibility();
    }
  };

  function updateColumnVisibility() {
    if (!gridApi) return;

    const container = gridApi.getContainer();
    if (!container) return;

    const gridWidth = container.offsetWidth;

    // Progressive column hiding based on width
    // 375px (iPhone SE): Title only
    // 640px+: Title + Type + Duration
    // 768px+: All columns

    if (gridWidth < 640) {
      // Mobile: Title only
      gridApi.setColumnsVisible(['contentType', 'duration', 'createdAt', 'updatedAt'], false);
    } else if (gridWidth < 768) {
      // Small tablet: Title + Type + Duration
      gridApi.setColumnsVisible(['contentType', 'duration'], true);
      gridApi.setColumnsVisible(['createdAt', 'updatedAt'], false);
    } else {
      // Desktop: All columns
      gridApi.setColumnsVisible(['contentType', 'duration', 'createdAt', 'updatedAt'], true);
    }
  }
</script>
```

**Source:** [AG Grid: Responsive Design](https://www.ag-grid.com/archive/17.0.0/javascript-grid-responsiveness/)

## State of the Art

| Old Approach | Current Approach | When Changed | Impact |
|--------------|------------------|--------------|--------|
| AG Grid Column API (columnApi.setVisible) | Grid API (gridApi.setColumnsVisible) | v31 (2023) | Code using Column API fails in v32 |
| Fixed height pagination panel | flex-wrap + height: auto | Dec 2024 (issue #9239) | Pagination now wraps on mobile instead of overflowing |
| CSS media queries for column hiding | gridSizeChanged event | v17+ (ongoing pattern) | Responsive to container width, not viewport |
| Tailwind v3 --primary variables | Tailwind v4 --color-primary | v4 (2024) | Variable naming convention changed |

**Deprecated/outdated:**
- **Column API methods** (v31+): All methods merged into Grid API. Use `gridApi.setColumnsVisible()`, not `columnApi.setVisible()`
- **Fixed pagination panel height**: AG Grid's default CSS caused mobile overflow issues, community adopted flex-wrap pattern
- **Viewport-only responsive design**: Modern pattern uses container queries and grid width detection for true component-level responsiveness

## Open Questions

Things that couldn't be fully resolved:

1. **Does shadcn-svelte Sheet component meet hamburger menu needs?**
   - What we know: shadcn-svelte provides Sheet component, used for drawer/sidebar patterns
   - What's unclear: Whether Sheet is accessible enough for primary navigation, or if dedicated navigation menu component needed
   - Recommendation: BUG-004 (P2, no responsive header collapse) is out of scope for Phase 2.1 P1 fixes. Defer hamburger menu decision to future phase focused on navigation enhancement.

2. **Should we add visual affordance for hidden columns (BUG-006)?**
   - What we know: At 375px, only Title column visible with no hint that horizontal scroll reveals more
   - What's unclear: Best UX pattern - badge showing "4 more columns", hint icon, or message?
   - Recommendation: BUG-006 is P3. Fix P1 issues first (BUG-001, BUG-002, BUG-003, BUG-005), then evaluate if column affordance is still needed after responsive hiding implementation.

3. **Will AG Grid v33+ include native mobile pagination fixes?**
   - What we know: GitHub issue #9239 closed as "completed" for upcoming release (Dec 2024)
   - What's unclear: Whether fixes shipped in v33.x or later; current project uses v32.2.x
   - Recommendation: Apply CSS workaround now (proven solution). When upgrading AG Grid, check changelog and test if CSS override can be removed.

## Sources

### Primary (HIGH confidence)

- [AG Grid v32 Documentation - Row Pagination](https://www.ag-grid.com/javascript-data-grid/row-pagination/) - Official pagination API
- [AG Grid v32 Documentation - Grid Layout](https://www.ag-grid.com/javascript-data-grid/grid-size/) - domLayout options, autoHeight behavior
- [AG Grid v32 Changelog](https://github.com/ag-grid/ag-grid/blob/v32.0.0/documentation/ag-grid-docs/public/changelog/releases/30_0_0.md) - Column API deprecation, Grid API migrations
- [Tailwind CSS: Responsive Design](https://tailwindcss.com/docs/responsive-design) - Breakpoints, mobile-first utilities
- [Tailwind CSS: Text Overflow](https://tailwindcss.com/docs/text-overflow) - truncate class implementation
- Context7: /ag-grid/ag-grid/v32.0.0 - Column visibility API, grid events
- Context7: /websites/tailwindcss - Responsive design patterns, breakpoint reference

### Secondary (MEDIUM confidence)

- [AG Grid GitHub Issue #9239](https://github.com/ag-grid/ag-grid/issues/9239) - Mobile pagination CSS workarounds (community verified)
- [AG Grid: Responsive Design (Archive v17)](https://www.ag-grid.com/archive/17.0.0/javascript-grid-responsiveness/) - Responsive column hiding patterns
- [CSS-Tricks: Flexbox and Truncated Text](https://css-tricks.com/flexbox-truncated-text/) - Flexbox min-width: 0 pattern
- [Medium: Truncate Text in Flex Containers](https://medium.com/@ademyalcin27/truncate-text-in-flex-containers-d3b81cc02cef) - Flex item truncation deep dive
- [BigBinary: Automatic Minimum Size of Flex Items](https://www.bigbinary.com/blog/understanding-the-automatic-minimum-size-of-flex-items) - min-width: auto behavior
- [Hatchjs: Dynamic Show/Hide Columns](https://hatchjs.com/ag-grid-show-hide-columns-dynamic-stackblitz/) - Working examples of gridSizeChanged

### Tertiary (LOW confidence)

- WebSearch results on shadcn-svelte responsive navigation (2026) - General patterns, not Svelte 5-specific
- WebSearch results on Svelte 5 hamburger menus - Library examples exist but not deeply vetted for Svelte 5 runes compatibility

## Metadata

**Confidence breakdown:**
- Standard stack: HIGH - Using existing project dependencies (Tailwind v4, AG Grid v32, native CSS)
- Architecture: HIGH - Patterns verified in AG Grid docs, Tailwind docs, and community GitHub issues
- Pitfalls: HIGH - Documented in official AG Grid changelog, CSS-Tricks articles, and real bug reports

**Research date:** 2026-02-07
**Valid until:** 60 days (stable ecosystem - Tailwind v4 and AG Grid v32 mature)

**Key considerations for planning:**
- All P1 fixes (BUG-001, BUG-002, BUG-003, BUG-005) can be addressed with CSS and Grid API changes
- BUG-004 (P2, hamburger menu) and BUG-006 (P3, column affordance) should be deferred to separate phases
- No new dependencies required
- Changes are localized to Header.svelte, ActivityTable.svelte, and app.css
- Testing requires Chrome DevTools MCP at 375px viewport width
