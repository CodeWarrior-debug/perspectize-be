---
phase: 03-add-video-flow
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - frontend/src/lib/components/shadcn/dialog/
  - frontend/src/lib/components/shadcn/input/
  - frontend/src/lib/components/shadcn/label/
  - frontend/src/lib/components/shadcn/index.ts
  - frontend/src/lib/utils/youtube.ts
  - frontend/src/lib/queries/content.ts
  - frontend/tests/unit/youtube.test.ts
  - frontend/tests/unit/queries-content.test.ts
autonomous: true

must_haves:
  truths:
    - "YouTube URL validation correctly identifies valid YouTube URLs (youtube.com/watch, youtu.be, m.youtube.com, /embed/, /shorts/)"
    - "YouTube URL validation rejects non-YouTube URLs and malformed strings without hanging (no catastrophic backtracking)"
    - "GraphQL mutation definition matches backend schema (createContentFromYouTube with CreateContentFromYouTubeInput)"
    - "shadcn Dialog, Input, and Label components are installed and exported from barrel"
  artifacts:
    - path: "frontend/src/lib/utils/youtube.ts"
      provides: "validateYouTubeUrl function"
      exports: ["validateYouTubeUrl"]
      min_lines: 15
    - path: "frontend/src/lib/queries/content.ts"
      provides: "CREATE_CONTENT_FROM_YOUTUBE mutation definition"
      contains: "CREATE_CONTENT_FROM_YOUTUBE"
    - path: "frontend/src/lib/components/shadcn/index.ts"
      provides: "Barrel exports for Dialog, Input, Label"
      contains: "Dialog"
    - path: "frontend/tests/unit/youtube.test.ts"
      provides: "Unit tests for YouTube URL validation"
      min_lines: 30
  key_links:
    - from: "frontend/src/lib/queries/content.ts"
      to: "backend/schema.graphql"
      via: "GraphQL mutation name must match"
      pattern: "createContentFromYouTube"
    - from: "frontend/src/lib/components/shadcn/index.ts"
      to: "frontend/src/lib/components/shadcn/dialog/"
      via: "barrel re-export"
      pattern: "from.*dialog"
---

<objective>
Install shadcn dialog/input/label components, create YouTube URL validation utility with comprehensive tests, and add the GraphQL mutation definition for creating content from YouTube URLs.

Purpose: Establish the foundation pieces (UI primitives, validation logic, mutation query) that the AddVideoDialog component needs in Plan 02.
Output: Tested YouTube URL validator, GraphQL mutation definition, and shadcn Dialog/Input/Label components ready for use.
</objective>

<execution_context>
@/Users/jamesjordan/.claude/get-shit-done/workflows/execute-plan.md
@/Users/jamesjordan/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-add-video-flow/03-RESEARCH.md

@frontend/src/lib/components/shadcn/index.ts
@frontend/src/lib/queries/content.ts
@frontend/src/lib/utils/.gitkeep
@frontend/vite.config.ts
@frontend/tests/unit/queries-content.test.ts
@frontend/tests/unit/utils.test.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install shadcn Dialog, Input, Label components</name>
  <files>
    frontend/src/lib/components/shadcn/dialog/
    frontend/src/lib/components/shadcn/input/
    frontend/src/lib/components/shadcn/label/
    frontend/src/lib/components/shadcn/index.ts
  </files>
  <action>
    1. Run shadcn-svelte CLI to add dialog, input, and label components:
       ```bash
       cd fe
       npx shadcn-svelte@latest add dialog input label --yes
       ```
       The CLI will create files under `src/lib/components/shadcn/dialog/`, `input/`, and `label/`.

    2. Update the barrel export file `src/lib/components/shadcn/index.ts` to include Dialog, Input, and Label exports. Keep alphabetized per existing convention. The file currently exports only Button. Add exports for:
       - Dialog (Dialog.Root, Dialog.Content, Dialog.Header, Dialog.Title, Dialog.Footer, Dialog.Description, Dialog.Overlay, Dialog.Close, Dialog.Portal, Dialog.Trigger)
       - Input
       - Label

       Check the generated `dialog/index.ts`, `input/index.ts`, and `label/index.ts` files to see exact export names and re-export them from the barrel file. Follow the same pattern as the existing Button export line.

    3. Verify the shadcn components installed correctly by checking that the directories and index files exist.
  </action>
  <verify>
    ```bash
    cd fe
    ls src/lib/components/shadcn/dialog/index.ts
    ls src/lib/components/shadcn/input/index.ts
    ls src/lib/components/shadcn/label/index.ts
    grep -q "Dialog" src/lib/components/shadcn/index.ts
    grep -q "Input" src/lib/components/shadcn/index.ts
    grep -q "Label" src/lib/components/shadcn/index.ts
    pnpm run check
    ```
  </verify>
  <done>
    Dialog, Input, and Label components installed under shadcn/ with all exports available from the barrel file. `pnpm run check` passes with no type errors.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create YouTube URL validation utility, mutation definition, and tests</name>
  <files>
    frontend/src/lib/utils/youtube.ts
    frontend/src/lib/queries/content.ts
    frontend/tests/unit/youtube.test.ts
    frontend/tests/unit/queries-content.test.ts
  </files>
  <action>
    1. **Create `src/lib/utils/youtube.ts`** with a `validateYouTubeUrl` function:
       - Uses `URL` constructor to parse (no complex regex -- avoids catastrophic backtracking)
       - Returns `boolean`
       - Valid hosts: `youtube.com`, `www.youtube.com`, `youtu.be`, `m.youtube.com`
       - For youtube.com hosts: pathname must include `/watch`, `/embed`, or `/shorts`
       - For youtu.be: pathname must have length > 1 (has video ID)
       - Empty/whitespace-only strings return false
       - Malformed URLs (non-parseable by URL constructor) return false
       - Reference implementation in 03-RESEARCH.md "YouTube URL Validation Utility" section

    2. **Delete `src/lib/utils/.gitkeep`** since the directory now has a real file.

    3. **Add mutation to `src/lib/queries/content.ts`**:
       Add `CREATE_CONTENT_FROM_YOUTUBE` mutation definition below the existing queries. The mutation matches the backend schema exactly:
       ```graphql
       mutation CreateContentFromYouTube($input: CreateContentFromYouTubeInput!) {
         createContentFromYouTube(input: $input) {
           id
           name
           url
           contentType
           length
           lengthUnits
           viewCount
           likeCount
           commentCount
           createdAt
         }
       }
       ```
       Export it as a named `const` using `gql` tagged template (same pattern as LIST_CONTENT and GET_CONTENT).

    4. **Create `tests/unit/youtube.test.ts`** with comprehensive tests:
       - Valid URLs: `https://www.youtube.com/watch?v=dQw4w9WgXcQ`, `https://youtu.be/dQw4w9WgXcQ`, `https://m.youtube.com/watch?v=abc`, `https://youtube.com/embed/abc`, `https://youtube.com/shorts/abc`, URL with extra params (t=30, list=PLxxx)
       - Invalid URLs: empty string, whitespace, `not-a-url`, `https://vimeo.com/123`, `https://youtube.com/` (no watch/embed/shorts), `https://youtu.be/` (no video ID), `https://notyoutube.com/watch?v=abc`
       - Edge cases: URL with trailing slash, URL with fragment, very long string (performance -- should not hang)
       - Use `describe`/`it` blocks, import from `$lib/utils/youtube`

    5. **Update `tests/unit/queries-content.test.ts`** to add tests for the new mutation:
       - Test that `CREATE_CONTENT_FROM_YOUTUBE` is exported and is a string (gql tagged template result)
       - Test that it contains `createContentFromYouTube` operation name
       - Test that it contains `CreateContentFromYouTubeInput` input type
       - Test that it requests expected fields: `id`, `name`, `url`, `contentType`
       - Follow the same pattern as existing LIST_CONTENT and GET_CONTENT tests in that file
  </action>
  <verify>
    ```bash
    cd fe
    pnpm run test:run
    pnpm run check
    ```
    All tests pass. Type-check passes. YouTube validation tests cover valid, invalid, and edge cases.
  </verify>
  <done>
    `validateYouTubeUrl` exported from `src/lib/utils/youtube.ts`. `CREATE_CONTENT_FROM_YOUTUBE` exported from `src/lib/queries/content.ts`. Both have comprehensive unit tests passing. No type errors.
  </done>
</task>

</tasks>

<verification>
1. `pnpm run test:run` -- all tests pass (existing + new youtube + mutation tests)
2. `pnpm run check` -- no TypeScript errors
3. `grep -q "validateYouTubeUrl" frontend/src/lib/utils/youtube.ts` -- utility exists
4. `grep -q "CREATE_CONTENT_FROM_YOUTUBE" frontend/src/lib/queries/content.ts` -- mutation exists
5. `grep -q "new URL" frontend/src/lib/utils/youtube.ts` -- uses URL constructor (not regex, avoids catastrophic backtracking)
6. `grep -q "Dialog" frontend/src/lib/components/shadcn/index.ts` -- Dialog exported
7. `grep -q "Input" frontend/src/lib/components/shadcn/index.ts` -- Input exported
8. `grep -q "Label" frontend/src/lib/components/shadcn/index.ts` -- Label exported
</verification>

<success_criteria>
- shadcn Dialog, Input, Label installed and exported from barrel
- `validateYouTubeUrl` passes all test cases (valid URLs accepted, invalid rejected, no backtracking)
- `CREATE_CONTENT_FROM_YOUTUBE` mutation matches backend schema
- All existing tests still pass
- Type-check clean
</success_criteria>

<output>
After completion, create `.planning/phases/03-add-video-flow/03-01-SUMMARY.md`
</output>
