# Phase 3.1: Design Token System - Context

**Gathered:** 2026-02-09
**Status:** Ready for planning

<domain>
## Phase Boundary

Implement all Figma design tokens in code: 22 Theme/Light color tokens, 4 rating color tokens, 1 brand token, and Geist + Charter dual-font typography. This is the foundation that makes shadcn components, AG Grid, and all future phases render correctly. No new UI features — just the token system.

</domain>

<decisions>
## Implementation Decisions

### Token source of truth
- **DESIGN_SPEC.md is authoritative** — where Radix 3.0 Figma values differ (muted, foreground, border), use DESIGN_SPEC.md values
- FIGMA.md already documents this: "use the Design Spec values as the source of truth for the frontend CSS tokens"
- Key differences to watch: `muted` (Radix has #262626 dark, spec has #F5F5F5 light), `foreground` (Radix #171717, spec #0A0A0A), `border` (Radix #d4d4d4, spec #E5E5E5)

### Color format in CSS
- **Use hex values in `@theme` block, not oklch** — directly verifiable against DESIGN_SPEC.md, eliminates oklch conversion errors
- Convert existing `--color-primary` from oklch to hex for consistency
- Rationale: Previous oklch values were wrong (MEMORY.md: "oklch(0.216 0.006 56.043) was near-black instead of correct value for #1a365d"). Hex is provably correct by inspection.

### Token naming convention
- Follow Tailwind v4 pattern: `--color-*` prefix (e.g., `--color-background`, `--color-foreground`)
- This is already the convention — `--color-primary` exists
- All tokens go in `@theme` block in `app.css`
- Usage: `bg-background`, `text-foreground`, `border-border`, etc.

### Hover/state tokens
- Define `primary-hover`, `secondary-hover`, `destructive-hover` as explicit tokens (not computed)
- `disabled` is an opacity value (0.5), not a color — define as `--opacity-disabled: 0.5` or apply via utility class
- Rationale: Explicit tokens match DESIGN_SPEC.md structure and are simpler than runtime computation

### Font loading strategy
- **Self-host Charter** alongside Geist (no CDN dependency)
- Charter weights: Regular 400, Italic 400, Bold 700 (from DESIGN_SPEC.md)
- Source: Download Charter woff2 files, place in `static/fonts/` next to Geist
- Define `--font-family-serif` in `@theme` for Tailwind's `font-serif` utility
- Fallback chain: `'Charter', 'Georgia', 'Times New Roman', serif`
- `font-display: swap` for both fonts (matches existing Geist pattern)

### AG Grid base theming
- Update `themeQuartz.withParams()` to reference the new token colors
- Include: navy header background, white header text, alternating row tints, branded pagination
- This is token consumption, not new UI features — in scope
- AG Grid's `fontFamily` updated from `'Inter, sans-serif'` to `'Geist, system-ui, sans-serif'` (headers/labels) — Charter for cell text is a Phase 3.2+ decision

### Claude's Discretion
- Whether to use CSS custom properties as intermediaries or direct hex in `@theme`
- Exact `font-display` timing (swap vs optional)
- Whether `--color-ring` should match `--color-primary` exactly or have slight variation
- Ordering and grouping of tokens within `@theme` block

</decisions>

<specifics>
## Specific Ideas

- The existing `--color-primary: oklch(0.333 0.077 257.109)` must be replaced with hex `#1a365d` to establish the hex-only pattern
- DESIGN_SPEC.md's "Current State Audit" lists the root cause: "`bg-background` references `--color-background` which is never defined in app.css. Resolves to transparent." — this phase fixes that directly
- All 27 tokens from DESIGN_SPEC.md § Color Tokens (22 Theme/Light + 4 Rating + 1 Brand)
- Charter font available from Matthew Carter / Bitstream (free, see practicaltypography.com/charter.html)

</specifics>

<deferred>
## Deferred Ideas

- Styled UserSelector dropdown (replacing native `<select>`) — separate component work
- Dialog visual polish (overlay, solid background) — Phase 3.2 builds on these tokens
- AG Grid advanced theming (card container, shadows, hover states) — Phase 3.2
- Dark mode token set — future milestone

</deferred>

---

*Phase: 03.1-dialog-ux-polish*
*Context gathered: 2026-02-09*
