---
phase: 07.4-performance-monitoring
plan: 01
subsystem: observability
tags: [slog, gorm, graphql, benchmarks, web-vitals, performance]

# Dependency graph
requires:
  - phase: 07.3
    provides: Clean caching architecture and query patterns

provides:
  - HTTP request timing middleware with slog structured logging (method, path, status, duration_ms, bytes, request_id)
  - GORM slow query callback plugin logging queries >100ms
  - /debug/db-stats endpoint serving sql.DBStats as JSON (dev-only)
  - gqlgen AroundOperations extension logging operation name and duration_ms
  - Go benchmark tests for ContentService and PerspectiveService
  - Frontend Web Vitals capture (LCP, CLS, INP, FCP, TTFB) with console logging

affects: [backend observability, frontend performance tracking, future APM integration]

# Tech tracking
tech-stack:
  added:
    - web-vitals (frontend npm package)
  patterns:
    - slog structured logging for request timing (replaces chi Logger)
    - GORM callback-based slow query detection with context-propagated start time
    - gqlgen OperationInterceptorFunc for GraphQL timing
    - Go benchmark tests with mocked repositories for reproducible baselines

key-files:
  created:
    - backend/pkg/middleware/timing.go
    - backend/pkg/middleware/timing_test.go
    - backend/pkg/database/plugins.go
    - backend/pkg/database/plugins_test.go
    - backend/pkg/database/stats.go
    - backend/pkg/database/stats_test.go
    - backend/pkg/graphql/timing.go
    - backend/pkg/graphql/timing_test.go
    - backend/test/services/content_service_bench_test.go
    - backend/test/services/perspective_service_bench_test.go
    - frontend/src/lib/vitals.ts
  modified:
    - backend/cmd/server/main.go
    - frontend/src/routes/+layout.svelte

key-decisions:
  - "slog-based RequestTimer replaces chi middleware.Logger for richer structured fields"
  - "Slow query threshold set at 100ms â€” logs SQL statement and duration"
  - "/debug/db-stats gated behind APP_ENV != production"
  - "Web Vitals logged to console in dev; ready for production analytics endpoint"

patterns-established:
  - "GORM callback registration pattern: Before/After pairs per operation (query, create, update, delete)"
  - "Context-propagated timing via queryStartKey{} for GORM callbacks"
  - "Go benchmark tests with mocked repository interfaces for service-layer baselines"

# Metrics
duration: 3min
completed: 2026-02-15
---

# Phase 07.4 Plan 01: Performance Monitoring Baselines

**Full-stack observability: HTTP timing, GORM slow queries, DB stats, GraphQL timing, Go benchmarks, Web Vitals**

## Performance

- **Duration:** ~3 min
- **Completed:** 2026-02-15
- **Tasks:** 6
- **Files created:** 11
- **Files modified:** 2

## Accomplishments

- HTTP request timing middleware logs method, path, status, duration_ms, bytes, request_id via slog
- GORM callbacks detect and log slow queries (>100ms) with SQL and row count
- /debug/db-stats endpoint serves sql.DBStats as JSON (dev-only)
- gqlgen AroundOperations extension logs GraphQL operation name and duration_ms
- Go benchmark tests for ContentService and PerspectiveService with mocked repositories
- Frontend captures all Core Web Vitals (LCP, CLS, INP, FCP, TTFB)

## Task Commits

- `aeb87df` feat(07.4): add performance monitoring baselines

## Deviations from Plan

None significant. All 6 tasks executed as planned.

## Next Phase Readiness

- All backend observability wired into main.go
- Frontend Web Vitals capture active
- Benchmark baselines established for service layer
- Ready for Phase 8 (User Integration Flow)

---
*Phase: 07.4-performance-monitoring*
*Completed: 2026-02-15*
